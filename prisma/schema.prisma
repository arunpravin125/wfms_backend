// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
  output   = "../backend/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}




model Employee {
  id                 Int                 @id @default(autoincrement())
  publicId           String              @unique
  username           String              @unique
  email              String?             @unique
  phone              String?
  firstName          String?
  lastName           String
  passwordHash       String?
  isActive           Boolean             @default(true)
  isStaff            Boolean             @default(false)
  isSuperuser        Boolean             @default(false)
  role               String?
  department         String?
  level              Int                 @default(1)
  parentId           Int?
  parent             Employee?           @relation("ParentChildren", fields: [parentId], references: [id])
  children           Employee[]          @relation("ParentChildren")
  dateOfBirth        DateTime?
  gender             String?
  address            String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  educations         Education[]
  emergencyContacts  EmergencyContact[]
  sessions           EmployeeSession[]
  failedLogins       FailedLoginAttempt[]
  loginOtps          LoginOTP[]
lastLogin DateTime?



}



model Education {
  id             Int      @id @default(autoincrement())
  degree         String
  university     String
  graduationYear String    // change from String? to Int?
  employeeId     Int
  employee       Employee @relation(fields: [employeeId], references: [id])
}


model EmergencyContact {
  id          Int      @id @default(autoincrement())
  employee    Employee @relation(fields: [employeeId], references: [id])
  employeeId  Int
  name        String
  phone       String
  address     String?
}

model EmployeeSession {
  id          Int      @id @default(autoincrement())
  sessionId   String   @unique
  employee    Employee @relation(fields: [employeeId], references: [id])
  employeeId  Int
  refreshToken String  @unique
  createdAt   DateTime @default(now())
  expiresAt   DateTime?
  isHibernated Boolean @default(false)
  lastActive  DateTime @default(now())
}

model FailedLoginAttempt {
  id        Int      @id @default(autoincrement())
  employee  Employee @relation(fields: [employeeId], references: [id])
  employeeId Int
  timestamp DateTime @default(now())
}

model LoginOTP {
  id        Int      @id @default(autoincrement())
  user      Employee @relation(fields: [userId], references: [id])
  userId    Int
  otp       String
  createdAt DateTime @default(now())
  expiresAt DateTime
}

model FilterData {
  id        String   @id @default(uuid())   // unique string ID
  filterName String? @unique
  department      String[]                        // text[] column
  roles          String[]
  level     Int[]                           // integer[] column
  createdAt DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

