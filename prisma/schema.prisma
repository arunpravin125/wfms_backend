// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
  output   = "../backend/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Employee {
  id            Int                 @id @default(autoincrement())
  publicId      String              @unique @default(uuid())
  username      String              @unique
  email         String?             @unique
  firstName     String?
  lastName      String?
  phone         String?
  passwordHash  String
  isActive      Boolean             @default(true)
  isSuperuser   Boolean             @default(false)
  role          String?             // e.g. "CEO", "Admin"
  level         Int?                // e.g. 1 for L1 Admin
  department    String?
  gender        String?
  dateOfBirth   DateTime?
  address       String?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  // relations
  educations       Education[]
  emergencyContact EmergencyContact[]
  otps             LoginOTP[]
}

model LoginOTP {
  id         Int      @id @default(autoincrement())
  user       Employee @relation(fields: [userId], references: [id])
  userId     Int
  otp        String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
}
  
model Education {
  id             Int      @id @default(autoincrement())
  employee       Employee @relation(fields: [employeeId], references: [id])
  employeeId     Int
  degree         String
  university     String
  graduationYear String?
}

model EmergencyContact {
  id          Int      @id @default(autoincrement())
  employee    Employee @relation(fields: [employeeId], references: [id])
  employeeId  Int
  name        String
  phone       String
  address     String?
}

// model User {
//   id          String   @id @default(cuid())
//   fullName    String
//   username    String   @unique
//   email       String   @unique
//   password    String
//   role        Role     @default(EMPLOYEE)
//   profilePic  String?
//   createdAt   DateTime @default(now())
//   updatedAt   DateTime @updatedAt
// }

// enum Role {
//   ADMIN
//   EMPLOYEE
// }


// model Employee {
//   id            String    @id @default(cuid())            // internal id
//   publicId      String    @unique @default(cuid())        // maps to public_id (shortcode generator can be used at create)
//   username      String    @unique
//   email         String?   @unique
//   phone         String?
//   firstName     String?
//   lastName      String?
//   otpSecret     String?
//   mfaEnabled    Boolean   @default(false)
//   level         Int       @default(1)
//   parentId      String?                                     
//   role          String?
//   department    String?
//   isActive      Boolean   @default(true)
//   isStaff       Boolean   @default(false)
//   lastLogin     DateTime?
//   createdAt     DateTime  @default(now())
//   updatedAt     DateTime  @updatedAt

//   dateOfBirth   DateTime?
//   gender        String?    // 'male'|'female'|'other'
//   address       String?

//   educations    Education[]
//   emergencyContacts EmergencyContact[]
//   sessions      EmployeeSession[]
//   failedLoginAttempts FailedLoginAttempt[]
//   loginOtps     LoginOTP[]
//    // if you need messages model later
// }

// model Education {
//   id         String   @id @default(cuid())
//   employee   Employee @relation(fields:[employeeId], references:[id])
//   employeeId String
//   school     String?
//   degree     String?
//   startYear  Int?
//   endYear    Int?
//   createdAt  DateTime @default(now())
//   updatedAt  DateTime @updatedAt
// }

// model EmergencyContact {
//   id         String   @id @default(cuid())
//   employee   Employee @relation(fields:[employeeId], references:[id])
//   employeeId String
//   name       String
//   phone      String
//   createdAt  DateTime @default(now())
//   updatedAt  DateTime @updatedAt
// }

// model EmployeeSession {
//   id           String   @id @default(cuid())
//   employee     Employee @relation(fields:[employeeId], references:[id])
//   employeeId   String
//   refreshToken String   @unique
//   createdAt    DateTime @default(now())
//   expiresAt    DateTime?
//   isHibernated Boolean  @default(false)
//   lastActive   DateTime @default(now())
// }

// model FailedLoginAttempt {
//   id         String   @id @default(cuid())
//   employee   Employee? @relation(fields:[employeeId], references:[id])
//   employeeId String?
//   ipAddress  String?
//   count      Int      @default(0)
//   createdAt  DateTime @default(now())
//   updatedAt  DateTime @updatedAt
// }

// model LoginOTP {
//   id         String   @id @default(cuid())
//   employee   Employee @relation(fields:[employeeId], references:[id])
//   employeeId String
//   otp        String
//   expiresAt  DateTime
//   createdAt  DateTime @default(now())
// }
